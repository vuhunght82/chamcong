<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ğŸ‘¨â€ğŸ’¼ Quáº£n lÃ½ cháº¥m cÃ´ng nhÃ¢n viÃªn</title>
<style>
  body { font-family: Arial, sans-serif; background-color: #f0f4f8; margin:0; padding:20px; text-align:center;}
  h1 { color:#007bff; margin-bottom:20px; }
  select, input[type="month"], button { padding:10px; font-size:16px; border-radius:8px; border:1px solid #ccc; margin:5px; outline:none;}
  button { background-color:#007bff; color:white; cursor:pointer; }
  button:hover { background-color:#0056b3; }
  table { width:100%; max-width:1000px; margin:20px auto; border-collapse:collapse; box-shadow:0 4px 10px rgba(0,0,0,0.1); background-color:white; }
  th { background-color:#007bff; color:white; padding:10px; }
  td { padding:8px; border:1px solid #ddd; text-align:center; }
  tr:hover { background-color:#f1f9ff; }
  .deleteBtn { background:#ff4d4f; color:white; padding:4px 8px; border:none; border-radius:5px; cursor:pointer; }
  .deleteBtn:hover { background:#c82333; }
  #summary { margin-top:20px; font-weight:bold; color:#333; }
</style>
</head>
<body>

<h1>ğŸ‘¨â€ğŸ’¼ Quáº£n lÃ½ cháº¥m cÃ´ng</h1>

<div>
  <label for="nhanvienSelect">NhÃ¢n viÃªn:</label>
  <select id="nhanvienSelect">
    <option value="">-- Chá»n nhÃ¢n viÃªn --</option>
  </select>

  <label for="monthSelect">ThÃ¡ng:</label>
  <input type="month" id="monthSelect" value="<?php echo date('Y-m'); ?>">
  
  <button id="reloadBtn">ğŸ”„ Táº£i láº¡i</button>
  <button id="exportBtn">ğŸ“Š Xuáº¥t Excel</button>
</div>

<table id="chamcongTable">
  <thead>
    <tr>
      <th>NgÃ y</th>
      <th>VÃ o sÃ¡ng</th>
      <th>Ra sÃ¡ng</th>
      <th>VÃ o chiá»u</th>
      <th>Ra chiá»u</th>
      <th>VÃ o lÃ m thÃªm</th>
      <th>Ra lÃ m thÃªm</th>
      <th>Giá» lÃ m (h)</th>
      <th>Giá» lÃ m thÃªm (h)</th>
      <th>Ghi chÃº</th>
      <th>XÃ³a</th>
    </tr>
  </thead>
  <tbody>
    <tr><td colspan="11">ChÆ°a cÃ³ dá»¯ liá»‡u</td></tr>
  </tbody>
</table>

<div id="summary"></div>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>

<!-- SheetJS -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>

<script>
// ================== Firebase Config ==================
const firebaseConfig = {
  apiKey: "AIzaSyAb5AZOBvEVY3a_9ioEKTW-wuVMXdnRZGQ",
  authDomain: "sellglass-3ebe9.firebaseapp.com",
  databaseURL: "https://sellglass-3ebe9-default-rtdb.asia-southeast1.firebasedatabase.app",
  projectId: "sellglass-3ebe9",
  storageBucket: "sellglass-3ebe9.appspot.com",
  messagingSenderId: "513741829035",
  appId: "1:513741829035:web:1b2c59dcf1a0be329358ee"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.database();

// ================== Elements ==================
const nhanvienSelect = document.getElementById('nhanvienSelect');
const monthSelect = document.getElementById('monthSelect');
const tableBody = document.querySelector('#chamcongTable tbody');
const summaryDiv = document.getElementById('summary');
const reloadBtn = document.getElementById('reloadBtn');
const exportBtn = document.getElementById('exportBtn');

let currentData = []; // dá»¯ liá»‡u Ä‘ang hiá»ƒn thá»‹ Ä‘á»ƒ xuáº¥t Excel

// ================== Load danh sÃ¡ch nhÃ¢n viÃªn ==================
function loadNhanVien() {
  db.ref('nhanvien').once('value').then(snapshot => {
    nhanvienSelect.innerHTML = '<option value="">-- Chá»n nhÃ¢n viÃªn --</option>';
    snapshot.forEach(child => {
      const nv = child.val();
      nhanvienSelect.insertAdjacentHTML('beforeend', `<option value="${nv.email}">${nv.ten} (${nv.email})</option>`);
    });
  });
}

// ================== HÃ m hiá»ƒn thá»‹ dá»¯ liá»‡u ==================
chamcong
 â””â”€ email_comma (vd: user,example@gmail,com)
      â””â”€ 2025-11-10
          vaoCaSang: "07:55"
          raCaSang: "11:30"
          ...

// ================== XÃ³a dÃ²ng ==================
tableBody.addEventListener('click', e => {
  if(e.target.classList.contains('deleteBtn')){
    const tr = e.target.closest('tr');
    const key = tr.dataset.key;
    const date = tr.children[0].textContent;
    if(confirm(`XÃ³a dá»¯ liá»‡u ngÃ y ${date}?`)){
      db.ref(`chamcong/${key}/${date}`).remove()
        .then(()=>{ tr.remove(); alert('âœ… XÃ³a thÃ nh cÃ´ng'); })
        .catch(err=>alert('âŒ Lá»—i: '+err));
    }
  }
});

// ================== Xuáº¥t Excel ==================
function exportToExcel() {
  if(!currentData || currentData.length===0){ alert('âš ï¸ KhÃ´ng cÃ³ dá»¯ liá»‡u Ä‘á»ƒ xuáº¥t.'); return; }
  const ws = XLSX.utils.json_to_sheet(currentData);
  const wb = XLSX.utils.book_new();
  XLSX.utils.book_append_sheet(wb, ws, "ChamCong");
  const filename = `ChamCong_${nhanvienSelect.options[nhanvienSelect.selectedIndex].text.replace(/[()]/g,'').replace(/\s+/g,'_')}.xlsx`;
  XLSX.writeFile(wb, filename);
}

// ================== Sá»± kiá»‡n ==================
nhanvienSelect.addEventListener('change', ()=>loadChamCong(nhanvienSelect.value, monthSelect.value));
monthSelect.addEventListener('change', ()=>loadChamCong(nhanvienSelect.value, monthSelect.value));
reloadBtn.addEventListener('click', loadNhanVien);
exportBtn.addEventListener('click', exportToExcel);

// ================== Khá»Ÿi Ä‘á»™ng ==================
window.addEventListener('load', loadNhanVien);
</script>

</body>
</html>

