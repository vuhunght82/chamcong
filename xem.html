<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Xem ch·∫•m c√¥ng</title>
<style>
  body { font-family: Arial; text-align:center; background:#f0f2f5; padding:20px;}
  h1 { color:#007bff; }
  table { margin:auto; border-collapse: collapse; width:90%; max-width:800px;}
  th, td { border:1px solid #007bff; padding:8px; }
  th { background:#007bff; color:white; }
  button { margin:10px; padding:8px 16px; font-size:16px; }
</style>
</head>
<style> body {
  font-family: Arial, sans-serif;
  text-align: center;
  background-color: #f0f2f5;
  margin: 0;
  padding: 0 10px; /* padding nh·ªè 2 b√™n cho mobile */
}

h1 {
  background-color: #007bff;
  color: white;
  padding: 15px;
  margin: 0 0 20px 0;
  font-size: 1.5em; /* to v·ª´a tr√™n mobile */
}

input, button {
  width: 90%;       /* r·ªông v·ª´a ƒë·ªß tr√™n mobile */
  max-width: 400px; /* kh√¥ng qu√° r·ªông tr√™n desktop */
  padding: 10px;
  margin: 5px 0;
  font-size: 1em;
  box-sizing: border-box;
}

#video-container {
  width: 100%;     /* chi·∫øm h·∫øt chi·ªÅu ngang */
  max-width: 360px;
  margin: 0 auto 20px auto;
  border: 2px solid #007bff;
  border-radius: 10px;
  overflow: hidden;
}

video {
  width: 100%;
  height: auto;
}

table {
  width: 100%;
  max-width: 100%;
  border-collapse: collapse;
  font-size: 0.9em;
}

th, td {
  padding: 6px;
  border: 1px solid #007bff;
  word-wrap: break-word;
}

th {
  background-color: #007bff;
  color: white;
}

button {
  font-size: 1em;
  padding: 10px 15px;
  margin: 5px;
}

/* Media query cho ƒëi·ªán tho·∫°i nh·ªè */
@media (max-width: 480px) {
  h1 {
    font-size: 1.3em;
    padding: 10px;
  }

  input, button {
    width: 95%;
    font-size: 1em;
  }

  th, td {
    font-size: 0.8em;
    padding: 4px;
  }

  #video-container {
    max-width: 100%;
  }
}
</style>
<body>

<h1>üìÑ Xem l·ªãch s·ª≠ ch·∫•m c√¥ng</h1>
<button id="logoutBtn">ƒêƒÉng xu·∫•t</button>
<button id="refreshBtn">C·∫≠p nh·∫≠t</button>

<table>
  <thead>
    <tr>
      <th>Ng√†y</th>
      <th>V√†o s√°ng</th>
      <th>Ra s√°ng</th>
      <th>V√†o chi·ªÅu</th>
      <th>Ra chi·ªÅu</th>
      <th>T·ªïng gi·ªù</th>
      <th>ƒêi mu·ªôn / Ghi ch√∫</th>
      <th>N·ªôi dung QR</th>
    </tr>
  </thead>
  <tbody id="tableBody">
  </tbody>
</table>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>

<script>
const firebaseConfig = {
  apiKey: "AIzaSyAb5AZOBvEVY3a_9ioEKTW-wuVMXdnRZGQ",
  authDomain: "sellglass-3ebe9.firebaseapp.com",
  databaseURL: "https://sellglass-3ebe9-default-rtdb.asia-southeast1.firebasedatabase.app",
  projectId: "sellglass-3ebe9",
  storageBucket: "sellglass-3ebe9.appspot.com",
  messagingSenderId: "513741829035",
  appId: "1:513741829035:web:1b2c59dcf1a0be329358ee"
};

firebase.initializeApp(firebaseConfig);
const db = firebase.database();

// L·∫•y userEmail
const userEmail = sessionStorage.getItem('userEmail');
if(!userEmail) {
  alert('Vui l√≤ng ƒëƒÉng nh·∫≠p tr∆∞·ªõc!');
  window.location.href = 'dangnhap.html';
}

const employeeId = userEmail.replace(/[@.]/g,'_');
const tableBody = document.getElementById('tableBody');

function loadAttendance() {
  tableBody.innerHTML = '<tr><td colspan="8">ƒêang t·∫£i...</td></tr>';

  db.ref('chamcong/' + employeeId).once('value', snapshot => {
    const data = snapshot.val();
    tableBody.innerHTML = '';

    if(!data) {
      tableBody.innerHTML = '<tr><td colspan="8">Ch∆∞a c√≥ d·ªØ li·ªáu ch·∫•m c√¥ng</td></tr>';
      return;
    }

    // S·∫Øp x·∫øp theo ng√†y gi·∫£m d·∫ßn
    const dates = Object.keys(data).sort((a,b)=> b.localeCompare(a));

    for(const date of dates){
      const row = data[date];
      const ghiChu = [];
      if(row.vaoCaSang && parseFloat(row.vaoCaSang.split(':')[0]+'.'+row.vaoCaSang.split(':')[1]) > 7.5) ghiChu.push('ƒêi mu·ªôn s√°ng');
      if(row.vaoCaChieu && parseFloat(row.vaoCaChieu.split(':')[0]+'.'+row.vaoCaChieu.split(':')[1]) > 13) ghiChu.push('ƒêi mu·ªôn chi·ªÅu');
      tableBody.innerHTML += `
        <tr>
          <td>${date}</td>
          <td>${row.vaoCaSang||'-'}</td>
          <td>${row.raCaSang||'-'}</td>
          <td>${row.vaoCaChieu||'-'}</td>
          <td>${row.raCaChieu||'-'}</td>
          <td>${row.gioLamTrongNgay||'0'}</td>
          <td>${ghiChu.join(', ')}</td>
          <td>${row.noiDungMaQuet||'-'}</td>
        </tr>
      `;
    }
  });
}

// N√∫t ƒëƒÉng xu·∫•t
document.getElementById('logoutBtn').addEventListener('click', () => {
  sessionStorage.removeItem('userEmail');
  window.location.href = 'dangnhap.html';
});

// N√∫t refresh
document.getElementById('refreshBtn').addEventListener('click', loadAttendance);

// T·∫£i khi m·ªü trang
window.addEventListener('load', loadAttendance);
</script>

</body>
</html>



