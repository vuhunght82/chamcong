<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Xem ch·∫•m c√¥ng</title>
<style>
  body { font-family: Arial; text-align:center; background:#f0f2f5; padding:20px;}
  h1 { color:#007bff; }
  table { margin:auto; border-collapse: collapse; width:90%; max-width:800px;}
  th, td { border:1px solid #007bff; padding:8px; }
  th { background:#007bff; color:white; }
  button { margin:10px; padding:8px 16px; font-size:16px; }
</style>
</head>
<body>

<h1>üìÑ Xem l·ªãch s·ª≠ ch·∫•m c√¥ng</h1>
<button id="logoutBtn">ƒêƒÉng xu·∫•t</button>
<button id="refreshBtn">C·∫≠p nh·∫≠t</button>

<table>
  <thead>
    <tr>
      <th>Ng√†y</th>
      <th>V√†o s√°ng</th>
      <th>Ra s√°ng</th>
      <th>V√†o chi·ªÅu</th>
      <th>Ra chi·ªÅu</th>
      <th>T·ªïng gi·ªù</th>
      <th>ƒêi mu·ªôn / Ghi ch√∫</th>
      <th>N·ªôi dung QR</th>
    </tr>
  </thead>
  <tbody id="tableBody">
  </tbody>
</table>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>

<script>
const firebaseConfig = {
  apiKey: "AIzaSyAb5AZOBvEVY3a_9ioEKTW-wuVMXdnRZGQ",
  authDomain: "sellglass-3ebe9.firebaseapp.com",
  databaseURL: "https://sellglass-3ebe9-default-rtdb.asia-southeast1.firebasedatabase.app",
  projectId: "sellglass-3ebe9",
  storageBucket: "sellglass-3ebe9.appspot.com",
  messagingSenderId: "513741829035",
  appId: "1:513741829035:web:1b2c59dcf1a0be329358ee"
};

firebase.initializeApp(firebaseConfig);
const db = firebase.database();

// L·∫•y userEmail
const userEmail = sessionStorage.getItem('userEmail');
if(!userEmail) {
  alert('Vui l√≤ng ƒëƒÉng nh·∫≠p tr∆∞·ªõc!');
  window.location.href = 'dangnhap.html';
}

const employeeId = userEmail.replace(/[@.]/g,'_');
const tableBody = document.getElementById('tableBody');

function loadAttendance() {
  tableBody.innerHTML = '<tr><td colspan="8">ƒêang t·∫£i...</td></tr>';

  db.ref('chamcong/' + employeeId).once('value', snapshot => {
    const data = snapshot.val();
    tableBody.innerHTML = '';

    if(!data) {
      tableBody.innerHTML = '<tr><td colspan="8">Ch∆∞a c√≥ d·ªØ li·ªáu ch·∫•m c√¥ng</td></tr>';
      return;
    }

    // S·∫Øp x·∫øp theo ng√†y gi·∫£m d·∫ßn
    const dates = Object.keys(data).sort((a,b)=> b.localeCompare(a));

    for(const date of dates){
      const row = data[date];
      const ghiChu = [];
      if(row.vaoCaSang && parseFloat(row.vaoCaSang.split(':')[0]+'.'+row.vaoCaSang.split(':')[1]) > 7.5) ghiChu.push('ƒêi mu·ªôn s√°ng');
      if(row.vaoCaChieu && parseFloat(row.vaoCaChieu.split(':')[0]+'.'+row.vaoCaChieu.split(':')[1]) > 13) ghiChu.push('ƒêi mu·ªôn chi·ªÅu');
      tableBody.innerHTML += `
        <tr>
          <td>${date}</td>
          <td>${row.vaoCaSang||'-'}</td>
          <td>${row.raCaSang||'-'}</td>
          <td>${row.vaoCaChieu||'-'}</td>
          <td>${row.raCaChieu||'-'}</td>
          <td>${row.gioLamTrongNgay||'0'}</td>
          <td>${ghiChu.join(', ')}</td>
          <td>${row.noiDungMaQuet||'-'}</td>
        </tr>
      `;
    }
  });
}

// N√∫t ƒëƒÉng xu·∫•t
document.getElementById('logoutBtn').addEventListener('click', () => {
  sessionStorage.removeItem('userEmail');
  window.location.href = 'dangnhap.html';
});

// N√∫t refresh
document.getElementById('refreshBtn').addEventListener('click', loadAttendance);

// T·∫£i khi m·ªü trang
window.addEventListener('load', loadAttendance);
</script>

</body>
</html>
