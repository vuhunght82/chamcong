<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>üìã Xem ch·∫•m c√¥ng</title>
<style>
body { font-family: Arial; margin: 20px; background:#f0f2f5; }
h1 { color:#007bff; text-align:center; }
table { width:100%; border-collapse: collapse; margin-top:20px; }
th, td { border:1px solid #007bff; padding:8px; text-align:center; }
th { background:#007bff; color:white; }
tr:nth-child(even){ background:#e6f0ff; }
button, select { padding:8px 12px; margin:5px; font-size:16px; }
</style>
</head>
<body>

<h1>üìã Xem ch·∫•m c√¥ng</h1>
<button id="backBtn">‚¨Ö Quay l·∫°i</button>
<label for="useremail">Nh√¢n vi√™n:</label>
<label for="monthSelect">Ch·ªçn th√°ng:</label>
<input type="month" id="monthSelect" />

<table>
  <thead>
    <tr>
      <th>Ng√†y</th>
      <th>V√†o Ca S√°ng</th>
      <th>Ra Ca S√°ng</th>
      <th>V√†o Ca Chi·ªÅu</th>
      <th>Ra Ca Chi·ªÅu</th>
      <th>Gi·ªù l√†m th√™m</th>
      <th>T·ªïng gi·ªù</th>
      <th>ƒê·ªãa ƒëi·ªÉm qu√©t</th>
      <th>Ghi ch√∫</th>
    </tr>
  </thead>
  <tbody id="attendanceBody">
    <tr><td colspan="9">Ch·ªçn th√°ng ƒë·ªÉ hi·ªÉn th·ªã d·ªØ li·ªáu</td></tr>
  </tbody>
</table>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>

<script>
const firebaseConfig = {
  apiKey: "AIzaSyAb5AZOBvEVY3a_9ioEKTW-wuVMXdnRZGQ",
  authDomain: "sellglass-3ebe9.firebaseapp.com",
  databaseURL: "https://sellglass-3ebe9-default-rtdb.asia-southeast1.firebasedatabase.app",
  projectId: "sellglass-3ebe9",
  storageBucket: "sellglass-3ebe9.appspot.com",
  messagingSenderId: "513741829035",
  appId: "1:513741829035:web:1b2c59dcf1a0be329358ee"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.database();

// L·∫•y email nh√¢n vi√™n hi·ªán t·∫°i
const userEmail = sessionStorage.getItem('userEmail');
if(!userEmail){
  alert('Vui l√≤ng ƒëƒÉng nh·∫≠p tr∆∞·ªõc!');
  window.location.href='index.html';
}
const emailKey = encodeEmail(userEmail);

const attendanceBody = document.getElementById('attendanceBody');
const monthSelect = document.getElementById('monthSelect');
const userNameDiv = document.getElementById('userName');

if(userEmail){
  const userKey = userEmail.replace(/\./g, ',');
  firebase.database().ref('nhanvien/' + userKey).once('value')
    .then(snapshot => {
      const userData = snapshot.val();
      if(userData && userData.ten){
        userNameDiv.textContent = `Nh√¢n vi√™n: ${userData.ten}`;
      } else {
       userNameDiv.textContent = `Nh√¢n vi√™n: ${userEmail}`;
      }
    })
    .catch(err => console.error("L·ªói l·∫•y t√™n nh√¢n vi√™n:", err));
} else {
  userNameDiv.textContent = "Nh√¢n vi√™n ch∆∞a ƒëƒÉng nh·∫≠p";
}


  
// Quay l·∫°i
document.getElementById('backBtn').addEventListener('click', ()=>{ window.history.back(); });

// L·∫•y d·ªØ li·ªáu theo th√°ng
monthSelect.addEventListener('change', ()=>{ loadAttendance(monthSelect.value); });

function loadAttendance(month) {
  if(!month) return;
  const [year, mon] = month.split('-');
  const start = `${year}-${mon}-01`;
  const end = `${year}-${mon}-31`;

  db.ref('chamcong/' + emailKey).once('value').then(snapshot=>{
    const data = snapshot.val() || {};
    const rows = [];

    Object.keys(data).forEach(date => {
      if(date >= start && date <= end){
        const d = data[date];
        rows.push({
          date,
          vaoCaSang: d.vaoCaSang || '-',
          raCaSang: d.raCaSang || '-',
          vaoCaChieu: d.vaoCaChieu || '-',
          raCaChieu: d.raCaChieu || '-',
          vaoLamThem: d.vaoLamThem || '-',
          raLamThem: d.raLamThem || '-',
          totalHours: d.gioLamTrongNgay || '-',
          location: d.diadiemQuet || '-',
          note: d.ghiChu || '-'
        });
      }
    });

    // S·∫Øp x·∫øp theo ng√†y
    rows.sort((a,b)=> a.date.localeCompare(b.date));

    attendanceBody.innerHTML = '';
    if(rows.length===0){
      attendanceBody.innerHTML='<tr><td colspan="9">Ch∆∞a c√≥ d·ªØ li·ªáu trong th√°ng n√†y</td></tr>';
    } else {
      rows.forEach(r=>{
        attendanceBody.innerHTML += `<tr>
          <td>${r.date}</td>
          <td>${r.vaoCaSang}</td>
          <td>${r.raCaSang}</td>
          <td>${r.vaoCaChieu}</td>
          <td>${r.raCaChieu}</td>
          <td>${r.vaoLamThem!=='-'? r.vaoLamThem+' - '+r.raLamThem:'-'}</td>
          <td>${r.totalHours}</td>
          <td>${r.location}</td>
          <td>${r.note}</td>
        </tr>`;
      });
    }

  }).catch(err=>{
    attendanceBody.innerHTML='<tr><td colspan="9">‚ùå L·ªói t·∫£i d·ªØ li·ªáu</td></tr>';
    console.error(err);
  });
}

// M√£ encode email
function encodeEmail(email){ return email.replace(/\./g,','); }

</script>

</body>
</html>





